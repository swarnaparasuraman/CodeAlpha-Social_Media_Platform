{% extends 'base.html' %}

{% block title %}Edit Profile - Glintz{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'accounts:profile' user.username %}" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5 text-gray-600"></i>
                    </a>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900">Edit Profile</h1>
                        <p class="text-sm text-gray-500">Manage your account settings and profile information</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button type="submit" form="edit-profile-form" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <form id="edit-profile-form" method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}

            <!-- Profile Picture Section -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <i data-lucide="user-circle" class="w-5 h-5 mr-2"></i>
                        Profile Picture
                    </h2>
                </div>
                <div class="p-6">
                    <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                        <!-- Current Profile Picture -->
                        <div class="relative">
                            <div class="w-32 h-32 rounded-full p-1 bg-gradient-to-tr from-purple-500 via-blue-500 to-indigo-500">
                                <div class="w-full h-full rounded-full border-4 border-white overflow-hidden">
                                    <img id="profile-preview" src="{{ user.profile.profile_picture.url }}"
                                         alt="{{ user.username }}"
                                         class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-blue-500 rounded-full border-4 border-white flex items-center justify-center cursor-pointer hover:bg-blue-600 transition-colors" onclick="document.getElementById('{{ profile_form.profile_picture.id_for_label }}').click()">
                                <i data-lucide="camera" class="w-4 h-4 text-white"></i>
                            </div>
                        </div>

                        <!-- Upload Controls -->
                        <div class="flex-1 text-center md:text-left">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">{{ user.username }}</h3>
                            <p class="text-gray-600 mb-4">Choose a profile picture that represents you</p>

                            <div class="flex flex-col sm:flex-row gap-3">
                                <button type="button" onclick="document.getElementById('{{ profile_form.profile_picture.id_for_label }}').click()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center">
                                    <i data-lucide="upload" class="w-4 h-4 mr-2"></i>
                                    Upload Photo
                                </button>
                                <button type="button" onclick="removeProfilePicture()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                                    <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                                    Remove
                                </button>
                            </div>

                            <input type="file" id="{{ profile_form.profile_picture.id_for_label }}" name="profile_picture" accept="image/*" class="hidden" onchange="previewProfilePicture(this)">
                            {% if profile_form.profile_picture.errors %}
                                <p class="mt-2 text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ profile_form.profile_picture.errors.0 }}
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <i data-lucide="user" class="w-5 h-5 mr-2"></i>
                        Personal Information
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Username -->
                        <div class="space-y-2">
                            <label for="{{ user_form.username.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="at-sign" class="w-4 h-4 mr-2 text-gray-500"></i>
                                Username
                            </label>
                            <div class="relative">
                                {{ user_form.username }}
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                                </div>
                            </div>
                            {% if user_form.username.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ user_form.username.errors.0 }}
                                </p>
                            {% endif %}
                        </div>

                        <!-- Email -->
                        <div class="space-y-2">
                            <label for="{{ user_form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="mail" class="w-4 h-4 mr-2 text-gray-500"></i>
                                Email Address
                            </label>
                            {{ user_form.email }}
                            {% if user_form.email.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ user_form.email.errors.0 }}
                                </p>
                            {% endif %}
                        </div>

                        <!-- First Name -->
                        <div class="space-y-2">
                            <label for="{{ user_form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="user" class="w-4 h-4 mr-2 text-gray-500"></i>
                                First Name
                            </label>
                            {{ user_form.first_name }}
                            {% if user_form.first_name.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ user_form.first_name.errors.0 }}
                                </p>
                            {% endif %}
                        </div>

                        <!-- Last Name -->
                        <div class="space-y-2">
                            <label for="{{ user_form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="user" class="w-4 h-4 mr-2 text-gray-500"></i>
                                Last Name
                            </label>
                            {{ user_form.last_name }}
                            {% if user_form.last_name.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ user_form.last_name.errors.0 }}
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Profile Details -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-pink-600 via-rose-600 to-orange-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <i data-lucide="edit-3" class="w-5 h-5 mr-2"></i>
                        Profile Details
                    </h2>
                </div>
                <div class="p-6 space-y-6">
                    <!-- Bio -->
                    <div class="space-y-2">
                        <label for="{{ profile_form.bio.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                            <i data-lucide="message-square" class="w-4 h-4 mr-2 text-gray-500"></i>
                            Bio
                        </label>
                        <div class="relative">
                            {{ profile_form.bio }}
                            <div class="absolute bottom-3 right-3 text-xs text-gray-400">
                                <span id="bio-count">0</span>/150
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">Tell people a little bit about yourself</p>
                        {% if profile_form.bio.errors %}
                            <p class="text-sm text-red-600 flex items-center">
                                <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                {{ profile_form.bio.errors.0 }}
                            </p>
                        {% endif %}
                    </div>

                    <!-- Location and Website -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="{{ profile_form.location.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-gray-500"></i>
                                Location
                            </label>
                            {{ profile_form.location }}
                            {% if profile_form.location.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ profile_form.location.errors.0 }}
                                </p>
                            {% endif %}
                        </div>

                        <div class="space-y-2">
                            <label for="{{ profile_form.website.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                                <i data-lucide="link" class="w-4 h-4 mr-2 text-gray-500"></i>
                                Website
                            </label>
                            {{ profile_form.website }}
                            {% if profile_form.website.errors %}
                                <p class="text-sm text-red-600 flex items-center">
                                    <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                    {{ profile_form.website.errors.0 }}
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Birth Date -->
                    <div class="space-y-2">
                        <label for="{{ profile_form.birth_date.id_for_label }}" class="block text-sm font-medium text-gray-700 flex items-center">
                            <i data-lucide="calendar" class="w-4 h-4 mr-2 text-gray-500"></i>
                            Birth Date
                        </label>
                        {{ profile_form.birth_date }}
                        <p class="text-xs text-gray-500">Your birth date won't be shown publicly</p>
                        {% if profile_form.birth_date.errors %}
                            <p class="text-sm text-red-600 flex items-center">
                                <i data-lucide="alert-circle" class="w-4 h-4 mr-1"></i>
                                {{ profile_form.birth_date.errors.0 }}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Privacy & Settings -->
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 px-6 py-4">
                    <h2 class="text-lg font-semibold text-white flex items-center">
                        <i data-lucide="shield" class="w-5 h-5 mr-2"></i>
                        Privacy & Settings
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i data-lucide="eye" class="w-5 h-5 text-blue-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Profile Visibility</h3>
                                    <p class="text-sm text-gray-500">Control who can see your profile</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                    <i data-lucide="bell" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">Email Notifications</h3>
                                    <p class="text-sm text-gray-500">Receive updates via email</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6">
                <a href="{% url 'accounts:profile' user.username %}" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                    <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                    Cancel
                </a>
                <button type="submit" form="edit-profile-form" class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for Enhanced Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }

    // Bio character counter
    const bioTextarea = document.querySelector('textarea[name="bio"]');
    const bioCounter = document.getElementById('bio-count');

    if (bioTextarea && bioCounter) {
        function updateBioCounter() {
            const count = bioTextarea.value.length;
            bioCounter.textContent = count;

            if (count > 150) {
                bioCounter.classList.add('text-red-500');
                bioCounter.classList.remove('text-gray-400');
            } else {
                bioCounter.classList.remove('text-red-500');
                bioCounter.classList.add('text-gray-400');
            }
        }

        bioTextarea.addEventListener('input', updateBioCounter);
        updateBioCounter(); // Initial count
    }

    // Form styling
    const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="url"], input[type="date"], textarea');
    inputs.forEach(input => {
        input.classList.add(
            'w-full', 'px-4', 'py-3', 'border', 'border-gray-300', 'rounded-lg',
            'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500', 'focus:border-transparent',
            'transition-all', 'duration-200', 'bg-white', 'text-gray-900',
            'placeholder-gray-500'
        );
    });
});

// Profile picture preview
function previewProfilePicture(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profile-preview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Remove profile picture
function removeProfilePicture() {
    const defaultImage = '/media/profile_pics/default.jpg';
    document.getElementById('profile-preview').src = defaultImage;
    document.getElementById('{{ profile_form.profile_picture.id_for_label }}').value = '';
}

// Success animation
function showSuccessMessage() {
    const toast = document.createElement('div');
    toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
    toast.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5 mr-2 inline"></i>Profile updated successfully!';
    document.body.appendChild(toast);

    setTimeout(() => {
        toast.classList.remove('translate-x-full');
    }, 100);

    setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 3000);
}
</script>

<style>
/* Custom scrollbar for textarea */
textarea::-webkit-scrollbar {
    width: 6px;
}

textarea::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

textarea::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

textarea::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Smooth transitions */
.transition-all {
    transition: all 0.2s ease-in-out;
}

/* Gradient backgrounds */
.bg-gradient-to-r {
    background: linear-gradient(to right, var(--tw-gradient-stops));
}

/* Focus states */
input:focus, textarea:focus {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Hover effects */
.hover\:shadow-xl:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}
</style>
{% endblock %}
